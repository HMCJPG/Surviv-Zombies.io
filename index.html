<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zombie Survival Arena</title>
  <style>
    canvas {
      background: #22a52f;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="600"></canvas>
  <button id="restartBtn" style="display:none; margin: 0 auto; display: block; font-size: 20px; padding: 10px 20px;">
    Play Again
  </button>
  
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const player = {
      x: canvas.width / 2,
      y: canvas.height / 2,
      radius: 20,
      speed: 3,
      angle: 0,
      hp: 100
    };

    const bullets = [];
    const enemies = [];
    const bulletSpeed = 6;
    const fireRate = 100;
    let lastShot = 0;
    let isShooting = false;
    let score = 0;
    let gameOver = false;

    const keys = {};
    document.addEventListener('keydown', e => keys[e.key] = true);
    document.addEventListener('keyup', e => keys[e.key] = false);
    canvas.addEventListener('mousemove', e => {
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      player.angle = Math.atan2(my - player.y, mx - player.x);
    });
    canvas.addEventListener('mousedown', () => isShooting = true);
    canvas.addEventListener('mouseup', () => isShooting = false);

    function movePlayer() {
      if (keys['w']) player.y -= player.speed;
      if (keys['s']) player.y += player.speed;
      if (keys['a']) player.x -= player.speed;
      if (keys['d']) player.x += player.speed;
    }

    function shootBullet() {
      const now = Date.now();
      if (now - lastShot >= fireRate) {
        const angle = player.angle;
        const muzzleX = player.x + Math.cos(angle) * (player.radius + 15);
        const muzzleY = player.y + Math.sin(angle) * (player.radius + 15);
        bullets.push({
          x: muzzleX,
          y: muzzleY,
          dx: Math.cos(angle) * bulletSpeed,
          dy: Math.sin(angle) * bulletSpeed
        });
        lastShot = now;
      }
    }

    function spawnEnemy() {
      const edge = Math.floor(Math.random() * 4);
      let x, y;
      if (edge === 0) { x = Math.random() * canvas.width; y = -30; } // top
      if (edge === 1) { x = canvas.width + 30; y = Math.random() * canvas.height; } // right
      if (edge === 2) { x = Math.random() * canvas.width; y = canvas.height + 30; } // bottom
      if (edge === 3) { x = -30; y = Math.random() * canvas.height; } // left
      enemies.push({ x, y, radius: 18, speed: 1.2, hp: 3 });
    }

    setInterval(() => {
      if (!gameOver) spawnEnemy();
    }, 1000); // every 1s

    function updateBullets() {
      for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i];
        b.x += b.dx;
        b.y += b.dy;

        // Remove if off-screen
        if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
          bullets.splice(i, 1);
        }
      }
    }

    function updateEnemies() {
      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];
        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const dist = Math.hypot(dx, dy);
        e.x += (dx / dist) * e.speed;
        e.y += (dy / dist) * e.speed;

        // Check collision with player
        if (dist < e.radius + player.radius) {
          enemies.splice(i, 1);
          player.hp -= 10;
          if (player.hp <= 0) {
            gameOver = true;
          }
          continue;
        }

        // Check collision with bullets
        for (let j = bullets.length - 1; j >= 0; j--) {
          const b = bullets[j];
          const d = Math.hypot(e.x - b.x, e.y - b.y);
          if (d < e.radius + 4) {
            e.hp--;
            bullets.splice(j, 1);
            if (e.hp <= 0) {
              enemies.splice(i, 1);
              score += 10;
            }
            break;
          }
        }
      }
    }

    function drawBullets() {
      ctx.fillStyle = 'yellow';
      bullets.forEach(b => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, 4, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function drawEnemies() {
      enemies.forEach(e => {
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.radius, 0, Math.PI * 2);
        ctx.fillStyle = 'green';
        ctx.fill();
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 2;
        ctx.stroke();
      });
    }

    function drawPlayer() {
      ctx.save();
      ctx.translate(player.x, player.y);
      ctx.rotate(player.angle);
      ctx.beginPath();
      ctx.arc(0, 0, player.radius, 0, Math.PI * 2);
      ctx.fillStyle = '#dab28c';
      ctx.fill();
      ctx.strokeStyle = 'black';
      ctx.lineWidth = 3;
      ctx.stroke();

      ctx.fillStyle = 'black';
      ctx.beginPath();
      ctx.roundRect(player.radius * 0.5, -5, 30, 10, 4);
      ctx.fill();
      ctx.restore();
    }

    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
        r = Math.min(r, w / 2, h / 2);
        this.beginPath();
        this.moveTo(x + r, y);
        this.arcTo(x + w, y, x + w, y + h, r);
        this.arcTo(x + w, y + h, x, y + h, r);
        this.arcTo(x, y + h, x, y, r);
        this.arcTo(x, y, x + w, y, r);
        this.closePath();
        return this;
      };
    }

    function drawUI() {
      // Health bar
      ctx.fillStyle = 'red';
      ctx.fillRect(20, 20, 200, 20);
      ctx.fillStyle = 'limegreen';
      ctx.fillRect(20, 20, Math.max(0, 200 * (player.hp / 100)), 20);
      ctx.strokeStyle = 'black';
      ctx.strokeRect(20, 20, 200, 20);

      // Score
      ctx.fillStyle = 'white';
      ctx.font = '20px sans-serif';
      ctx.fillText(`Score: ${score}`, 20, 60);
    }

    function drawGameOver() {
      ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'white';
      ctx.font = '48px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('Game Over', canvas.width / 2, canvas.height / 2 - 20);
      ctx.font = '28px sans-serif';
      ctx.fillText(`Score: ${score}`, canvas.width / 2, canvas.height / 2 + 30);
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (!gameOver) {
        movePlayer();
        if (isShooting) shootBullet();
        updateBullets();
        updateEnemies();
        drawBullets();
        drawEnemies();
        drawPlayer();
        drawUI();
      } else {
        drawGameOver();
        restartBtn.style.display = 'block';

      }
      requestAnimationFrame(gameLoop);
    }

    gameLoop();
    const restartBtn = document.getElementById('restartBtn');

restartBtn.addEventListener('click', () => {
  // Reset game state
  player.hp = 100;
  player.x = canvas.width / 2;
  player.y = canvas.height / 2;
  score = 0;
  bullets.length = 0;
  enemies.length = 0;
  gameOver = false;
  restartBtn.style.display = 'none';
});

  </script>
</body>
</html>
